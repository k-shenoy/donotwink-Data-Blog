---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
library(tidyverse)
library(readxl)
library(gganimate)
library(dplyr)
library(ggrepel)

thegreen <- rgb(0,250,154, max=255, alpha = 15)
windowsFonts(font14 = windowsFont("Lucida Sans"))

el <- read_excel("C:/Users/Keshav/OneDrive/dataviz/prez19762016.xlsx")
elsub <- subset(el, democ!="NA")
pop <- read_excel("C:/Users/Keshav/OneDrive/dataviz/elec2.xlsx")
eljoin <- left_join(elsub, pop)
eljoin <- subset(eljoin, year!="1976")

p <- ggplot(eljoin, aes(x = (as.numeric(repub)-as.numeric(democ)), y = totalvotes/vep, group = state_fips)) +
  geom_point(
    aes(color = (as.numeric(repub)-as.numeric(democ))), 
    size = 10) +
  geom_text(aes(label = state_po), family = "font14", nudge_y = .001) +
  scale_x_continuous(
    limits = c(-.6, .6), 
    breaks = c(-0.5, -0.25, 0, 0.25, 0.5), 
    labels = c("+50%Dem", "+25%Dem", "0", "+25%GOP", "+50%GOP")) +
  scale_color_gradient2(low = "darkblue", mid = "gray80", high="red") +
  theme(
    panel.background = element_blank(),
    panel.grid = element_line(color = "gray85"),
    panel.spacing = margin(6,6,6,6, "mm"),
    plot.background = element_rect(fill=thegreen),
    plot.caption = element_text(size = 14, hjust = .95, color = "gray40"),
    plot.subtitle = element_text(size=22, color = "gray30"),
    plot.margin = margin(6,6,6,6, "mm"),
    axis.title.y = element_text(size=18, color = "black"), 
    axis.title.x = element_text(size=18, color = "black"), 
    axis.text.x = element_text(size = 14),
    axis.text.y = element_text(size = 14),
    legend.position = "none",
    text = element_text(family="font14"), 
    title = element_text(size = 30)
    ) +
  labs(
    title = "Political Distribution of States in {closest_state}",
    subtitle = "Presidential Elections from 1980 to 2016",
    x = "Difference between Dem and GOP Percentage of Vote",
    y = "Voter Turnout (Total Votes/VEP)",
    caption = "\nIG: do_not_wink | Source: MIT Election Data and Science Lab & United States Election Project\n*Excluding Washington DC"
  )
p <- p +  transition_states(year, transition_length = 2, state_length = 3) + 
  ease_aes('sine-in-out')
animate(p, renderer = av_renderer(), nframes=500, fps=15, width=800, height=800)
anim_save("prezscatter.mp4")

```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.